CREATE OR REPLACE PROCEDURE AVGMARKS 

IS

CURSOR C_IAMARKS IS 

SELECT GREATEST(TEST1,TEST2) AS A, GREATEST(TEST1,TEST3) AS B, 

GREATEST(TEST3,TEST2) AS C 

FROM IAMARKS 

WHERE FINALIA IS NULL 

FOR UPDATE; 

 C_A NUMBER;

 C_B NUMBER;

 C_C NUMBER;

 C_SM NUMBER;

 C_AV NUMBER;

BEGIN 

 OPEN C_IAMARKS; 

 LOOP 

 FETCH C_IAMARKS INTO C_A, C_B, C_C; 

 EXIT WHEN C_IAMARKS%NOTFOUND; 

 --DBMS_OUTPUT.PUT_LINE(C_A || ' ' || C_B || ' ' || C_C); 

 IF (C_A != C_B) THEN 

C_SM:=C_A+C_B;

 ELSE

C_SM:=C_A+C_C;

 END IF;

 C_AV:=C_SM/2;

 --DBMS_OUTPUT.PUT_LINE('SUM = '||C_SM);

 --DBMS_OUTPUT.PUT_LINE('AVERAGE = '||C_AV);

 UPDATE IAMARKS SET FINALIA=C_AV WHERE CURRENT OF C_IAMARKS;

 END LOOP; 

 CLOSE C_IAMARKS; 

END;

/
BEGIN

AVGMARKS; --IT INVOKES THE STORED PROCEDURE

END;

/
SELECT * FROM IAMARKS;
